# ğŸ˜¦ Index Scan vs Full Table Scan

## Index Scan
### ì¸ë±ìŠ¤ëŠ” í° í…Œì´ë¸”ì—ì„œ ì†ŒëŸ‰ì˜ ë°ì´í„°ë¥¼ ê²€ìƒ‰í•  ë•Œ ì‚¬ìš©í•œë‹¤. ì˜¨ë¼ì¸ íŠ¸ëœì ì…˜ ì²˜ë¦¬ ì‹œìŠ¤í…œì—ì„œëŠ” ì†ŒëŸ‰ ë°ì´í„°ë¥¼ ì£¼ë¡œ ê²€ìƒ‰í•˜ë¯€ë¡œ ì¸ë±ìŠ¤ íŠœë‹ì´ ë¬´ì—‡ë³´ë‹¤ ì¤‘ìš”í•˜ë‹¤.
### ì¸ë±ìŠ¤ë¥¼ íŠœë‹í•œë‹¤ëŠ” ê²ƒì€ í…Œì´ë¸” ì—‘ì„¸ìŠ¤ë¥¼ ì¤„ì´ëŠ” ê²ƒì´ë‹¤.
![image](https://user-images.githubusercontent.com/71022555/166112306-9d2ab0da-717c-4e4a-a0c1-8fd30da3d02d.png)  
  

1. ì¸ë±ìŠ¤(Index)ë¥¼ êµ¬ì„±í•˜ëŠ” ì»¬ëŸ¼ì˜ ê°’ì„ ê¸°ë°˜ìœ¼ë¡œ ë°ì´í„°ë¥¼ ì¶”ì¶œí•˜ëŠ” ì•¡ì„¸ìŠ¤ ê¸°ë²•ì´ë‹¤.
2. ì¸ë±ìŠ¤ì— ì¡´ì¬í•˜ì§€ ì•ŠëŠ” ì»¬ëŸ¼ì˜ ê°’ì´ í•„ìš”í•œ ê²½ìš°ì—ëŠ” í˜„ì¬ ì½ì€ ë ˆì½”ë“œì˜ ì‹ë³„ìë¥¼ ì´ìš©í•˜ì—¬ í…Œì´ë¸”ì„ ì•¡ì„¸ìŠ¤ í•´ì•¼í•œë‹¤. ê·¸ëŸ¬ë‚˜ SQLë¬¸ì—ì„œ í•„ìš”ë¡œ í•˜ëŠ” ëª¨ë“  ì»¬ëŸ¼ì´ ì¸ë±ìŠ¤ êµ¬ì„± ì»¬ëŸ¼ì— í¬í•¨ëœ ê²½ìš° í…Œì´ë¸”ì— ëŒ€í•œ ì•¡ì„¸ìŠ¤ëŠ” ë°œìƒí•˜ì§€ ì•ŠëŠ”ë‹¤.
3. ì¸ë±ìŠ¤ êµ¬ì„± ì»¬ëŸ¼ì´ A+Bì¸ ê²½ìš° ì»¬ëŸ¼ Aë¡œ ì •ë ¬ ë˜ê³  ì»¬ëŸ¼ Aì˜ ê°’ì´ ë™ì¼í•  ê²½ìš° ì»¬ëŸ¼ Bë¡œ ì •ë ¬ëœë‹¤. ê·¸ë¦¬ê³  ì»¬ëŸ¼ Bê¹Œì§€ ëª¨ë‘ ë™ì¼í•˜ë©´ ë ˆì½”ë“œ ì‹ë³„ìë¡œ ì •ë ¬ëœë‹¤.
4. ì¸ë±ìŠ¤ê°€ êµ¬ì„± ì»¬ëŸ¼ìœ¼ë¡œ ì •ë ¬ë˜ì–´ ìˆê¸° ë•Œë¬¸ì— ì¸ë±ìŠ¤ë¥¼ ê²½ìœ í•˜ì—¬ ë°ì´í„°ë¥¼ ì½ìœ¼ë©´ ê²°ê³¼ ë˜í•œ ì •ë ¬ ë˜ì–´ ë°˜í™˜ëœë‹¤. -> ë”°ë¼ì„œ ì¸ë±ìŠ¤ ìˆœì„œì™€ ë™ì¼í•œ ì •ë ¬ ìˆœì„œë¥¼ ì‚¬ìš© ì‹œ ì •ë ¬ ì‘ì—…ì„ í•˜ì§€ ì•Šì•„ë„ ëœë‹¤.

### ë™ì‘ ë°©ì‹
1. ê²€ìƒ‰í•  ë°ì´í„°ë¥¼ ê¸°ì¤€ìœ¼ë¡œ ì¸ë±ìŠ¤ ë°ì´í„°ì— ì ‘ê·¼ì„ í•œë‹¤.
2. ì¸ë±ìŠ¤ ìë£Œêµ¬ì¡°ì— ì ‘ê·¼í•˜ì—¬ idê°’ì„ í†µí•´ ì‹¤ì§ˆì ìœ¼ë¡œ ì›í•˜ëŠ” ë°ì´í„°ë¥¼ ì¶”ì¶œí•œë‹¤.(íŠ¸ë¦¬ êµ¬ì¡°ì´ê¸° ë–„ë¬¸ì— í‰ê· ì ìœ¼ë¡œ logNê³¼ì •)

## Full Table Scan
![image](https://user-images.githubusercontent.com/71022555/166112625-e8a4ec97-da89-4816-80b1-1540332eedd4.png)  
  
1. í…Œì´ë¸”ì— ì¡´ì¬í•˜ëŠ” ëª¨ë“  ë°ì´í„°ë¥¼ ì½ì–´ ê°€ë©´ì„œ ì¡°ê±´ì— ë§ìœ¼ë©´ ê²°ê³¼ë¡œì„œ ì¶”ì¶œí•˜ê³  ì¡°ê±´ì— ë§ì§€ ì•Šìœ¼ë©´ ë²„ë¦¬ëŠ” ë°©ì‹ì´ë‹¤.
2. ê·¸ë¦¼ ì²˜ëŸ¼ ì¼ë°˜ì ìœ¼ë¡œ ë¸”ë¡ë“¤ì€ ì„œë¡œ ì¸ì í•´ ìˆê¸° ë•Œë¬¸ì— Full Table Scanì€ í•œ ë²ˆì— I/Oì— ì—¬ëŸ¬ ë¸”ë¡ì„ ì˜®ê²¨ ì˜¨ë‹¤. ì¦‰ í•œë²ˆì˜ I/Oì— ë°ì´í„°ë¥¼ ë‹¤ì¤‘ ë¸”ë¡ ë‹¨ìœ„ë¡œ ë©”ëª¨ë¦¬ì— ê°€ì ¸ì˜¤ê¸° ë•Œë¬¸ì—, Row ë‹¹ ì†Œìš”ë˜ëŠ” ì…ì¶œë ¥ ë¹„ìš©ì´ ì¸ë±ìŠ¤ ìŠ¤ìº”ì— ë¹„í•´ ì ë‹¤.
  
### ì˜µí‹°ë§ˆì´ì €ê°€ Full Table Scanì„ ì„ íƒí•˜ëŠ” ê²½ìš°
|ìƒí™©|ì„¤ëª…|
|:---|:---|
|ì ìš© ê°€ëŠ¥í•œ ì¸ë±ìŠ¤ê°€ ì—†ëŠ” ê²½ìš°|1. ê²°í•© ì¸ë±ìŠ¤ì˜ ì„ ë‘ ì»¬ëŸ¼ì´ ì¡´ì¬í•˜ì§€ ì•Šì„ ë•Œ.  2. ì ìš©í•  ì¸ë±ìŠ¤ê°€ ìˆì§€ë§Œ ì»¬ëŸ¼ì„ ê°€ê³µ, ì—°ì‚°í•˜ì—¬ í•´ë‹¹ ì¸ë±ìŠ¤ë¥¼ ì‚¬ìš©í•  ìˆ˜ ì—†ì„ ë•Œ|
|ë„“ì€ ë²”ìœ„ì˜ ë°ì´í„° ì•¡ì„¸ìŠ¤|ì¸ë±ìŠ¤ë¥¼ ì ìš© ê°€ëŠ¥í•˜ë”ë¼ë„ ì²˜ë¦¬ ë²”ìœ„ê°€ ë„“ì–´ Full Table Scanì´ ë” íš¨ê³¼ì ì„ ê²½ìš° Full Table Scan ì ìš© ê°€ëŠ¥|
|ì†ŒëŸ‰ì˜ í…Œì´ë¸” ì•¡ì„¸ìŠ¤|ê³ ìˆ˜ìœ„ ë§ˆí¬(HWM)ë‚´ì— ìˆëŠ” ë¸”ë¡ì´ DB_FILE_MULTIBLOCK_REWAD_COUNT(í•œë²ˆì— I/O ì½ì–´ë“¤ì´ëŠ” ìµœëŒ€ ë¸”ëŸ­ ìˆ˜)ì´ë‚´ì— ìˆë‹¤ë©´ Full Table Scanì´ ì¼ì–´ë‚  ìˆ˜ ìˆë‹¤.|
|ë³‘ë ¬ì²˜ë¦¬ ì•¡ì„¸ìŠ¤|ë³‘ë ¬ì²˜ë¦¬ëŠ” Full Table Scanì„ ë”ìš± íš¨ê³¼ì ìœ¼ë¡œ ìˆ˜í–‰í•˜ê²Œ ë˜ë¯€ë¡œ ë³‘ë ¬ì²˜ë¦¬ë¡œ ìˆ˜í–‰ë˜ëŠ” ì‹¤í–‰ê³„íšì„ ìˆ˜ë¦½í•  ë•ŒëŠ” í•­ìƒ Full Table Scanì„ ì„ íƒí•œë‹¤.|
|Full íŒíŠ¸ë¥¼ ì ìš©í•œ ê²½ìš°|Full íŒíŠ¸ë¥¼ ì‚¬ìš©í–ˆì„ ë•Œ Full íŒíŠ¸ê°€ ì ì ˆí•˜ì§€ ì•ŠëŠ” ê²½ìš° ì˜µí‹°ë§ˆì´ì €ê°€ ì´ë¥¼ ë¬´ì‹œ í•  ìˆ˜ ìˆë‹¤.|
  
> DB_FILE_MULTIBLOCK_READ_COUNT : ì´ ê°’ì´ í¬ë©´ ë” ë§ì€ ìˆ˜ì˜ ë¸”ë¡ì„ ì½ì–´ì˜¤ë¯€ë¡œ Full Table Scanì‹œì—ëŠ” ì„±ëŠ¥ì´ ì¦ê°€í•œë‹¤. í•˜ì§€ë§Œ íŠ¹ì • ë¸”ë¡ë§Œ í•„ìš”í•œ ê²½ìš° ë‚­ë¹„ê°€ ë  ìˆ˜ ìˆìœ¼ë©° Buffer poolì„ ë§ì´ ì°¨ì§€í•¨ìœ¼ë¡œì¨ ìì£¼ ì“°ì´ëŠ” ë°ì´í„°ë¥¼ ë°€ì–´ë‚´ì–´ Cacheíš¨ìœ¨ì„ ë–¨ì–´ëœ¨ë¦¬ëŠ” ê²°ê³¼ë¥¼ ê°€ì ¸ì˜¬ ìˆ˜ë„ ìˆë‹¤.

  
## ğŸ¤” ë­ê°€ ë” íš¨ìœ¨ì ì¸ê°€ìš”?
### ê°€ì •
1. row ê°œìˆ˜ : 10,000
2. 1 block = 10 row
3. Index Columnì˜ ë¶„í¬ë„ëŠ” 10%
4. ì¸ë±ìŠ¤ rowì— í•´ë‹¹í•˜ëŠ” í…Œì´ë¸”ì˜ rowëŠ” ê° blockì— í•˜ë‚˜ì”©ë§Œ ì¡´ì¬(ìµœì•…ì˜ ê²½ìš°)
> ë¶„í¬ë„ : ë°ì´í„° ë³„ í‰ê·  row ìˆ˜ / í…Œì´ë¸”ì˜ ì´ row ìˆ˜ * 100
= 1 / ì»¬ëŸ¼ ê°’ì˜ ì¢…ë¥˜ * 100
ex) 5ê°œì˜ ì‚¬ì—…ì¥ì„ ê°€ì§„ íšŒì‚¬ì˜ 'ì‚¬ì—…ì¥' ì»¬ëŸ¼ì˜ ì¢…ë¥˜ëŠ” 5ì´ë¯€ë¡œ
ì‚¬ì—…ì¥ ì»¬ëŸ¼ì˜ ë¶„í¬ë„ëŠ” 1 / 5 * 100 -> 20%

### Full Table Scan ë°©ì‹
> Scan Cost : í…Œì´ë¸”ë‚´ì˜ ì´ row ìˆ˜ / ë¸”ë¡ ë‚´ì˜ row ìˆ˜
1. DB í…Œì´ë¸” ì²« ë²ˆì§¸ ë¸”ë¡ë¶€í„° ìˆœì„œëŒ€ë¡œ ì ‘ê·¼
2. Sacn Cost = 10,000/ 10 -> 1,000

### Index Scan ë°©ì‹  
1. í•´ë‹¹ ì¸ë±ìŠ¤ rowì— ìˆëŠ” RowID ì •ë³´ë¥¼ ì´ìš©í•˜ì—¬ ëŒ€ì‘ë˜ëŠ” ì‹¤ì œ í…Œì´ë¸” rowì— ì ‘ê·¼í•œë‹¤.
2. ê·¸ ë‹¤ìŒ ì¸ë±ìŠ¤ rowê°€ ëë‚  ë•Œê¹Œì§€ ì¸ë±ìŠ¤ rowë¥¼ ì°¨ë¡€ëŒ€ë¡œ ìŠ¤ìº”í•˜ë©° ëŒ€ì‘ë˜ëŠ” ì‹¤ì œ í…Œì´ë¸”ì˜ rowë¥¼ ì°¾ëŠ” ì‘ì—…ì„ ë°˜ë³µí•œë‹¤.
> ì´ ì¸ë±ìŠ¤ ìˆ˜ = í…Œì´ë¸”ì˜ ì´ row ìˆ˜ * ì¸ë±ìŠ¤ columnì˜ ë¶„í¬ë„ -> = 1,000ê°œ -> ì¸ë±ìŠ¤ì— ëŒ€ì‘í•˜ëŠ” í…Œì´ë¸”ì˜ rowê°€ ê° blockë‹¹ 1ê°œì´ë¯€ë¡œ, 1,000ê°œì˜ ë¸”ë¡ ì ‘ê·¼ í•„ìš”
4. ìœ„ ê³„ì‚°ì„ í†µí•´, ë‘ ê²½ìš° ëª¨ë‘ 1,000ê°œì˜ ë¸”ë¡ ì ‘ê·¼ì´ í•„ìš”í•˜ë‹¤.
5. ë”°ë¼ì„œ **ì¸ë±ìŠ¤ ì‚¬ìš© ì†ìµ ë¶„ê¸°ì ì€ 10%**ì„ì„ ì•Œ ìˆ˜ ìˆìœ¼ë©° ì»¬ëŸ¼ì˜ ë¶„í¬ë„ê°€ 10~15%ì¸ ê²½ìš° ì¸ë±ìŠ¤ì˜ RowIDë¥¼ í†µí•œ Random Access ë¹„ìš© ë•Œë¬¸ì— Table Full Scanì´ ë” ì¢‹ì€ ê²ƒì„ ì•Œ ìˆ˜ ìˆë‹¤.  

> ë¶„í¬ë„ ê³µì‹ : 1 : 1/í•´ë‹¹ ì»¬ëŸ¼ì˜ distinct ë°ì´í„° ê°œìˆ˜ * 100 2 : ë°ì´í„°ë³„ í‰ê·  Rows / í…Œì´ë¸” ì „ì²´ Rows * 100

### 1/í•´ë‹¹ ì»¬ëŸ¼ì˜ distinct ë°ì´í„° ê°œìˆ˜ * 100(MariaDB)
```sql
select (1/cnt)*100
from (
	select count(distinct code) cnt /* select 9 rows */
	from XXX
) a
```
### ë°ì´í„°ë³„ í‰ê·  Rows / í…Œì´ë¸” ì „ì²´ Rows * 100(MariaDB)
```sql
select ((avg(tot)/(select count(1) from XXX))*100) selectivity
from(
	select count(code) tot
	from XXX
	group by code
) a
```
### ê²°ë¡ 
ì¸ë±ìŠ¤ëŠ” ëŒ€ë¶€ë¶„ ì ì€ ì–‘ì˜ ë°ì´í„°ë¥¼ ì¡°íšŒí•  ë•Œ ìœ ë¦¬í•˜ê³ , ì´ ì™¸ì˜ ê²½ìš° Full Scanì´ ë” ìœ ë¦¬í•˜ë‹¤.


ì°¸ê³  ìë£Œ  

---
https://hoon93.tistory.com/53  
https://techgoeasy.com/how-to-find-which-sid-is-doing-full_30/  
https://jdm.kr/blog/169